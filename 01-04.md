# [**MITRE ATT&CK Enterprise FrameWork**](https://attack.mitre.org/)

> by HTTP 418 I'm a teapot. @NSFOCUS

***

<!-- TOC -->

- [**MITRE ATT&CK Enterprise FrameWork**](#mitre-attck-enterprise-framework)
  - [Perface](#perface)
  - [Initial Access (初始访问)](#initial-access-%e5%88%9d%e5%a7%8b%e8%ae%bf%e9%97%ae)
    - [Drive-by Compromise (路过式威胁)](#drive-by-compromise-%e8%b7%af%e8%bf%87%e5%bc%8f%e5%a8%81%e8%83%81)
      - [缓解](#%e7%bc%93%e8%a7%a3)
      - [检测](#%e6%a3%80%e6%b5%8b)
    - [Exploit Public-Facing Application (利用大众化应用程序)](#exploit-public-facing-application-%e5%88%a9%e7%94%a8%e5%a4%a7%e4%bc%97%e5%8c%96%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f)
      - [缓解](#%e7%bc%93%e8%a7%a3-1)
      - [检测](#%e6%a3%80%e6%b5%8b-1)
    - [External Remote Services (外部远程服务)](#external-remote-services-%e5%a4%96%e9%83%a8%e8%bf%9c%e7%a8%8b%e6%9c%8d%e5%8a%a1)
      - [缓解](#%e7%bc%93%e8%a7%a3-2)
      - [检测](#%e6%a3%80%e6%b5%8b-2)
    - [Hardware Additions (物理渗透硬件)](#hardware-additions-%e7%89%a9%e7%90%86%e6%b8%97%e9%80%8f%e7%a1%ac%e4%bb%b6)
      - [缓解](#%e7%bc%93%e8%a7%a3-3)
      - [检测](#%e6%a3%80%e6%b5%8b-3)
    - [Replication Through Removable Media (通过可移动媒介复制)](#replication-through-removable-media-%e9%80%9a%e8%bf%87%e5%8f%af%e7%a7%bb%e5%8a%a8%e5%aa%92%e4%bb%8b%e5%a4%8d%e5%88%b6)
      - [缓解](#%e7%bc%93%e8%a7%a3-4)
      - [检测](#%e6%a3%80%e6%b5%8b-4)
    - [Spearphishing Attachment (鱼叉式钓鱼附件)](#spearphishing-attachment-%e9%b1%bc%e5%8f%89%e5%bc%8f%e9%92%93%e9%b1%bc%e9%99%84%e4%bb%b6)
      - [缓解](#%e7%bc%93%e8%a7%a3-5)
      - [检测](#%e6%a3%80%e6%b5%8b-5)
    - [Spearphishing Link (鱼叉式钓鱼链接)](#spearphishing-link-%e9%b1%bc%e5%8f%89%e5%bc%8f%e9%92%93%e9%b1%bc%e9%93%be%e6%8e%a5)
      - [缓解](#%e7%bc%93%e8%a7%a3-6)
      - [检测](#%e6%a3%80%e6%b5%8b-6)
    - [Spearphishing via Service (服务式鱼叉钓鱼)](#spearphishing-via-service-%e6%9c%8d%e5%8a%a1%e5%bc%8f%e9%b1%bc%e5%8f%89%e9%92%93%e9%b1%bc)
      - [缓解](#%e7%bc%93%e8%a7%a3-7)
      - [检测](#%e6%a3%80%e6%b5%8b-7)
    - [Supply Chain Compromise (供应链入侵)](#supply-chain-compromise-%e4%be%9b%e5%ba%94%e9%93%be%e5%85%a5%e4%be%b5)
      - [缓解](#%e7%bc%93%e8%a7%a3-8)
      - [检测](#%e6%a3%80%e6%b5%8b-8)
    - [Trusted Relationship (受信关系)](#trusted-relationship-%e5%8f%97%e4%bf%a1%e5%85%b3%e7%b3%bb)
      - [缓解](#%e7%bc%93%e8%a7%a3-9)
      - [检测](#%e6%a3%80%e6%b5%8b-9)
    - [Valid Accounts (合法账号)](#valid-accounts-%e5%90%88%e6%b3%95%e8%b4%a6%e5%8f%b7)
      - [缓解](#%e7%bc%93%e8%a7%a3-10)
      - [检测](#%e6%a3%80%e6%b5%8b-10)
  - [Execution (执行)](#execution-%e6%89%a7%e8%a1%8c)
    - [AppleScript (AppleScript)](#applescript-applescript)
      - [缓解](#%e7%bc%93%e8%a7%a3-11)
      - [检测](#%e6%a3%80%e6%b5%8b-11)
    - [CMSPT (CMSTP.exe)](#cmspt-cmstpexe)
      - [缓解](#%e7%bc%93%e8%a7%a3-12)
      - [检测](#%e6%a3%80%e6%b5%8b-12)
    - [Command-Line Interface (命令行界面)](#command-line-interface-%e5%91%bd%e4%bb%a4%e8%a1%8c%e7%95%8c%e9%9d%a2)
      - [缓解](#%e7%bc%93%e8%a7%a3-13)
      - [检测](#%e6%a3%80%e6%b5%8b-13)
    - [Compiled HTML File (.chm文件)](#compiled-html-file-chm%e6%96%87%e4%bb%b6)
      - [缓解](#%e7%bc%93%e8%a7%a3-14)
      - [检测](#%e6%a3%80%e6%b5%8b-14)
    - [Component Object Model and Distributed COM (COM & DCOM)](#component-object-model-and-distributed-com-com--dcom)
      - [缓解](#%e7%bc%93%e8%a7%a3-15)
      - [检测](#%e6%a3%80%e6%b5%8b-15)
    - [Control Panel Items (控制面板项)](#control-panel-items-%e6%8e%a7%e5%88%b6%e9%9d%a2%e6%9d%bf%e9%a1%b9)
      - [缓解](#%e7%bc%93%e8%a7%a3-16)
      - [检测](#%e6%a3%80%e6%b5%8b-16)
    - [Dynamic Data Exchange (动态数据交换协议)](#dynamic-data-exchange-%e5%8a%a8%e6%80%81%e6%95%b0%e6%8d%ae%e4%ba%a4%e6%8d%a2%e5%8d%8f%e8%ae%ae)
      - [缓解](#%e7%bc%93%e8%a7%a3-17)
      - [检测](#%e6%a3%80%e6%b5%8b-17)
    - [Execution through API (通过API执行)](#execution-through-api-%e9%80%9a%e8%bf%87api%e6%89%a7%e8%a1%8c)
      - [缓解](#%e7%bc%93%e8%a7%a3-18)
      - [检测](#%e6%a3%80%e6%b5%8b-18)
    - [Execution through Module Load (通过模块加载执行)](#execution-through-module-load-%e9%80%9a%e8%bf%87%e6%a8%a1%e5%9d%97%e5%8a%a0%e8%bd%bd%e6%89%a7%e8%a1%8c)
      - [缓解](#%e7%bc%93%e8%a7%a3-19)
      - [检测](#%e6%a3%80%e6%b5%8b-19)
    - [Execution for Client Execution (客户端执行的利用)](#execution-for-client-execution-%e5%ae%a2%e6%88%b7%e7%ab%af%e6%89%a7%e8%a1%8c%e7%9a%84%e5%88%a9%e7%94%a8)
  - [Persistence (持久化)](#persistence-%e6%8c%81%e4%b9%85%e5%8c%96)
  - [Privilege Escalation (提权)](#privilege-escalation-%e6%8f%90%e6%9d%83)

<!-- /TOC -->

***

## Perface

基于**MITRE ATT&CK模型**整理的文档式中译版。

建议针对**关键词语**采用双语对照，可以参照[**Initial Access**](#initial-access-%e5%88%9d%e5%a7%8b%e8%ae%bf%e9%97%ae)。

***

## Initial Access (初始访问)

>[攻击者正试图进入您的网络](https://attack.mitre.org/tactics/TA0001/)

**初始访问** 包括使用 **各种入口向量** 在网络中获得其 **初始入侵点** 的技术。用于获取 **入侵点** 技术包括 **针对性的鱼叉攻击** 和 **公共Web服务器** 。通过 **初始访问** 获得的 **入侵点** 可能支持进一步侵入，例如 **有效的帐户群** 和 **远程服务的外部使用权** ，也可能由于密码的修改而失效。

***

### Drive-by Compromise (路过式威胁)

>[原文链接](https://attack.mitre.org/techniques/T1189/)

**路过式威胁** 是指攻击者通过用户在正常浏览过程中访问网站来获得对系统的访问权限。使用此技术，通常会将用户的Web浏览器作为攻击目标，但攻击者也可能会将受侵害的网站用于非利用行为，例如获取应用程序访问令牌。

存在多种将漏洞利用代码传递给浏览器的方法，包括：

- 恶意代码的注入
- 恶意广告的投放
- 内置的Web内容 (论坛帖子、评论等等)

攻击者使用的网站通常是特定社区(例如政府，特定行业或地区)访问的网站，其目标是基于共同利益来威胁特定用户或一组用户。这种有针对性的攻击被称为战略性网络入侵或水坑攻击。

- 用户访问了托管了攻击者受控内容的网站
- 脚本会自动执行，通常会搜索存在漏洞的浏览器或插件版本
  - 可能要求用户通过启用脚本或活动的网站组件并忽略警告对话框来协助此过程
- 一旦发现有漏洞的版本，攻击代码将会传到浏览器
- 如果利用成功，那么除非有其他保护措施，否则它将使攻击者代码在用户的系统上执行
  - 在某些情况下，在提供漏洞利用代码之前，需要在初始扫描后再次访问网站
  
#### 缓解

缓解|描述
:--:|:--
应用隔离与沙箱机制|浏览器沙箱可用于减轻某些利用的影响，其他类型的虚拟化和应用程序微分段也可以减轻客户端利用的影响
漏洞防护|查找漏洞利用过程中的行为的安全应用程序
限制基于Web的内容|对于通过广告投放的恶意代码，adblocker可以帮助阻止该代码首先执行。脚本阻止扩展可以帮助阻止可能在开发过程中普遍使用的JavaScript的执行。
更新软件|确保所有浏览器和插件保持更新

#### 检测

- 防火墙和代理可以检查URL中潜在的已知危险域或参数
- 网络入侵检测系统，有时配合SSL/TLS MITM检测，可以查找已知的恶意脚本
- 合法网站的 **路过式威胁** 检测会很困难，还要寻找终端所提供的成功入侵的证据

***

### Exploit Public-Facing Application (利用大众化应用程序)

>[原文链接](https://attack.mitre.org/techniques/T1189/)

使用软件，数据或命令来利用面向 Internet 的计算机系统或程序中的脆弱点，从而导致意外或无法预期的行为。

- 系统的弱点可能是bug，故障或设计漏洞
- 这些应用程序通常是网站，但是可以包括数据库(例如SQL)，标准服务(例如SMB或SSH)以及具有Internet可访问开放套接字的任何其他应用程序
- 如果应用程序托管在基于云的基础架构上，利用这一点可能会导致底层受到损害。这可以让攻击者获得访问云API或利用弱身份和访问管理策略

#### 缓解

缓解|描述
:--:|:--
应用隔离与沙箱机制|应用程序隔离将限制被利用的目标对其他进程和系统功能的访问
漏洞防护|WAF可用于限制应用程序的暴露
网络隔离|使用 DMZ 或在独立的托管基础设施，将面向外部的服务器和服务与网络的其他部分分离
账户权限|最小化特权
软件更新|确保应用保持最新
更新软件|定期扫描外部系统的漏洞，并建立程序以在通过扫描和公开披露发现重大漏洞时快速修补系统

#### 检测

- 监视应用程序日志中是否有异常行为
- DPI检测
- WAF

***

### External Remote Services (外部远程服务)

>[原文链接](https://attack.mitre.org/techniques/T1133/)

VPN，Citrix 和其他访问机制等远程服务使用户可以从外部位置连接到内部企业网络资源。经常有远程服务网关管理这些服务的连接和凭据身份验证。Windows Remote Management 等服务也可以在外部使用。

- 攻击者可以通过远程服务进行初始入侵 **和/或** 在网络中持久化
- 访问有效账户对于该服务是必须的，可以通过篡改和在入侵企业网络后获取

#### 缓解

缓解|描述
:--:|:--
禁用或删除功能或程序|禁用或阻止可能不必要的远程可用服务
限制通过网络对资源的访问|通过集中管理的集中器(例如VPN)和其他托管的远程访问系统，限制对远程服务的访问
多因素认证|对远程服务帐户使用强大的两因素或多因素身份验证
网络隔离|通过使用网络代理，网关和防火墙来拒绝对内部系统的直接远程访问

#### 检测

- 检测恶意使用有效账户对远程服务进行认证
- 收集身份验证日志并分析异常访问模式，以及正常工作时间之外的访问

***

### Hardware Additions (物理渗透硬件)

>[原文链接](https://attack.mitre.org/techniques/T1200/)

计算机附件、计算机或网络硬件可以作为获得执行的载体引入系统。 虽然 APT 组织使用的公共的很少，但是许多渗透测试人员利用物理渗透硬件来获得初始访问。 商业和开源产品利用了被动网络访问 、中间人破解 、击键注入 、通过DMA读取内核内存、向现有网络 添加新的无线访问等功能。

#### 缓解

缓解|描述
:--:|:--
限制通过网络对资源的访问|建立网络访问控制策略，如使用设备证书和 802.1x 标准。 将DHCP的使用限制在已注册的设备上，以防止未注册的设备与可信系统通信
限制硬件安装|通过终端安全配置和监视代理拦截未知设备和附件

#### 检测

资产管理系统可以帮助检测不应存在于网络中的计算机系统或网络设备。 终端传感器可以通过 USB、Thunderbolt 和其他外部设备通信端口检测添加的硬件。

***

### Replication Through Removable Media (通过可移动媒介复制)

>[原文链接](http://vulhub.org.cn/attack/techniques/T1091.md)

攻击者可以通过将恶意软件复制到可移动媒介上，利用媒体插入系统并执行的自动运行特性，转移到系统，这些系统处于未连通或气隙网络上。在 **横向移动** 中，可以修改可移动媒介中的可执行文件，或者复制恶意软件并将其重命名，使其看起来像合法文件，从而诱使用户在独立的系统上执行它。对于 **初始访问** ，可以通过手动操作媒体、修改用于初始格式化媒体的系统或修改媒体本身的固件来实现。

#### 缓解

缓解|描述
:--:|:--
禁用或删除功能或程序|如果不需要，可以禁用autorun;如果业务操作不需要可移动媒介，则在组织策略级别上禁止或限制它
限制硬件安装|限制在网络中使用USB设备和可移动媒介

#### 检测

- 监视可移动媒介上的文件访问
- 检测在可移动媒介被挂载或由用户启动后执行的进程

***

### Spearphishing Attachment (鱼叉式钓鱼附件)

>[原文链接](https://attack.mitre.org/techniques/T1192/)

鱼叉式钓鱼附件是鱼叉式网络钓鱼的一种特殊变体,鱼叉附件使用了 **附加到电子邮件的恶意软件**。所有形式的鱼叉式钓鱼都是以电子方式提供的针对特定个人，公司或行业的社会工程学。在此情况下，攻击者将文件附加到钓鱼邮件中，并且依赖用户执行。

#### 缓解

缓解|描述
:--:|:--
杀毒软件|防病毒软件可以自动隔离可疑文件
网络入侵防护|网络入侵防御系统以及旨在扫描和删除恶意电子邮件附件的系统可以用来阻止活动
限制基于Web的内容|默认情况下，阻止不应该通过电子邮件传输的未知或未使用的附件是最佳做法，以防止某些媒介
用户培训|可以培训用户识别社交工程技术和电子邮件伪装

#### 检测

网络入侵检测系统和电子邮件网关可用于检测带有恶意附件的鱼叉式网络钓鱼。 引爆设计(detonation chambers)也可用于识别恶意附件。解决方案可以是基于签名和行为的，但是攻击者可能以某种方式构造附件来避免这些机制。

杀毒软件在扫描存储在电子邮件服务器或用户计算机上的文件时，可能会检测到恶意文档和附件。 终端检测或网络检测可以在打开附件(例如 Microsoft Word 文档或 PDF 文件，可以连接到 internet 或生成 Powershell) 时潜在地检测恶意事件，这些事件与客户端执行和脚本的漏洞利用等技术有关。

***

### Spearphishing Link (鱼叉式钓鱼链接)

>[原文链接](https://attack.mitre.org/techniques/T1192/)

鱼叉式钓鱼链接是鱼叉式钓鱼的一种特殊变体，区别在于他是用 **链接下载电子邮件的恶意软件**

#### 缓解

缓解|描述
:--:|:--
限制基于Web的内容|确定某些可用于造假网站的网站对于业务运营是否必要，并在无法很好地监控活动或构成重大风险的情况下考虑阻止访问
用户培训|可以培训用户识别社交工程技术和电子邮件伪装

#### 检测

检查电子邮件中的 **URL** 有助于检测指向已知恶意站点的链接。 引爆设计 (detonation chambers) 可用于检测这些链接，并自动转到这些站点以确定它们是否具有潜在恶意，或在等待用户访问链接时捕获内容。 这种技术通常涉及终端上的用户交互，因此一旦用户执行，就可能检测到鱼叉式钓鱼链接。

***

### Spearphishing via Service (服务式鱼叉钓鱼)

>[原文链接](http://vulhub.org.cn/attack/techniques/T1194.md)

服务式鱼叉钓鱼是鱼叉式钓鱼的一种特殊变体，区别在于他采用的是 **第三方服务** 。

攻击者将创建虚假的社交媒体帐户，并向员工传达潜在的工作机会。这样做可以提出合理的理由来询问环境中运行的服务，策略和软件。然后，攻击者可以通过这些服务发送恶意链接或附件。

#### 缓解

缓解|描述
:--:|:--
杀毒软件|防病毒软件可以自动隔离可疑文件
限制基于Web的内容|确定第三方服务对于企业的运营是否必要，不必要可以考虑阻止访问
用户培训|实行安全培训

#### 检测

***

### Supply Chain Compromise (供应链入侵)

>[原文链接](https://attack.mitre.org/techniques/T1195/)

供应链折衷是为了最终数据或系统折衷目的而在最终消费者收到产品或产品交付机制之前对其进行的操纵。

供应链入侵可以发生在供应链的任何阶段，包括：

- 开发工具的操作
- 开发环境的操作
- 源代码库的操作
- 软件更新/分发机制
- 受损/感染的系统映像
- 用修改的版本替换合法软件
- 向合法分销商销售修改/仿冒产品

尽管供应链的攻击可能会影响硬件或软件的任意组件，但想要获得执行的攻击者往往关注在软件分发阶段或更新渠道中对合法软件进行的恶意添加。 可以以特定的受害者群体为目标， 或将恶意软件分发给广泛的消费者群体，但仅对特定受害者的附加策略。

#### 缓解

缓解|描述
:--:|:--
更新软件|应该实施补丁程序管理过程
漏洞扫描|漏洞源的持续监视以及使用自动和手动代码检查工具

#### 检测

通过哈希校验或其他完整性校验机制来检验分布式二进制文件。扫描下载的文件查找是否有恶意签名，并尝试在部署之前测试软件和更新，同时注意潜在的可疑活动。对硬件进行物理检查以查找潜在的篡改。

***

### Trusted Relationship (受信关系)

>[原文链接](https://attack.mitre.org/techniques/T1199/)

攻击者可能会破坏或利用能够接触到目标受害者的组织。通过可信的第三方关系利用现有的连接，这些连接可能不受保护或者受到的审查比获取网络访问权的标准机制少。组织通常授予第二或第三方外部提供商高级访问权限，以允许它们管理内部系统。这些关系的例子包括IT服务承包商、托管安全供应商、基础设施承包商(例如HVAC、电梯、物理安全)。 第三方提供商的访问权可能被限制在所维护的基础结构内，但是可能与企业的其他部分在相同的网络中。这样，另一方用于访问内部网络系统的有效帐户可能会遭到破坏和使用

#### 缓解

缓解|描述
:--:|:--
网络隔离|网络分割隔离无需广泛网络访问的基础设施组件
用户帐号控制|妥善管理可受信关系中各方使用的帐户和权限

#### 检测

建立对由第二方和第三方提供商以及其他受信任实体进行的活动的监视。根据关系的类型，攻击可能在执行操作之前可以访问有关目标的大量信息，尤其是在信任的关系基于IT服务的情况下。攻击者可能能够快速地朝着目标行事，因此对与凭据访问，横向移动和收集有关的行为进行适当的监视对于检测入侵至关重要。

***

### Valid Accounts (合法账号)

>[原文链接](https://attack.mitre.org/techniques/T1078/)

攻击者可以使用凭据访问技术窃取特定用户或服务帐户的凭据，或者在侦察过程的早期通过社会工程来获取凭据以获得初始访问权限。

攻击者可能使用的帐户可以分为三类：默认帐户，本地帐户和域帐户。

被盗取的凭证可用于绕过网络内系统上的各种资源的访问控制，甚至可能用于对远程系统和外部可用服务的持久化。被盗取的凭证可能还会给攻击者提供特定系统或网络受限区域的特权。攻击者可能选择不将恶意软件或工具与这些凭据提供的合法访问结合使用，使其更难被察觉。

默认帐户也不仅限于客户端计算机上的访客和管理员，还包括为设备(例如网络设备和计算机应用程序)而预先设置的帐户，无论它们是内部，开放源代码还是COTS。预先设置了用户名和密码的设备会对在安装后不进行更改的使用者构成严重威胁，它们很容易成为攻击者的目标。同样，攻击者也可以利用公开披露的私钥或被盗的私钥通过远程服务 合法地连接到远程环境。

帐户访问权，凭据和权限在整个系统网络中的重叠是令人关注的，因为攻击者可能能够跨帐户和系统打到高访问级别(即域或企业管理员)，从而绕过企业内部访问控制。

#### 缓解

缓解|描述
:--:|:--
应用程序开发人员指南|确保应用程序不会不安全地存储敏感数据或凭据。(例如，代码中的纯文本凭据，存储库中已发布的凭据或公共云存储中的凭据)
用户帐号控制|妥善管理可受信关系中各方使用的帐户和权限
过滤网络流量|考虑在基于云的系统上将IP白名单与用户帐户管理一起使用
多因素认证|将多因素身份验证 (MFA) 集成为组织策略的一部分可以极大地降低g攻击者获得对有效凭据的控制的风险
密码策略|在安装后和部署到生产环境之前，应立即更改使用默认用户名和密码的应用程序和设备
特权账户管理|例行审核域和本地帐户及其权限级别，还应包括是否启用了默认帐户，或者是否创建了未经授权的新本地帐户
用户帐号管理|通过身份和访问管理 (IAM) 控件，确保用户和用户组对其角色具有适当的权限

#### 检测

- 在整个企业和外部可访问的服务配置健壮，一致的帐户活动审核策略
- 在共享帐户(用户，管理员或服务帐户)的系统中查找可疑帐户行为
- 对域和本地系统帐户进行​​定期审核

***

## Execution (执行)

>[攻击者试图运行恶意代码](https://attack.mitre.org/tactics/TA0002/)

**执行** 是指攻击者控制的代码在本地或者远程系统上运行，通常恶意代码通常与所有其他策略结合使用，以达成更大的目标。

***

### AppleScript (AppleScript)

>[原文链接](https://attack.mitre.org/techniques/T1155/)

**macOS** 和 **OS** **X** 的应用互相发送 **AppleEvent** 消息以实现进程间通信(IPC)。AppleScript 可以轻松编写本地或远程IPC的通信消息。Osascript 执行 AppleScript 和任何其他开放脚本编写体系结构 (OSA) 语言脚本。可以使用 osalang 程序找到安装在系统上的 OSA 语言列表

攻击者可以使用它与打开的SSH连接进行交互，移至远程计算机，甚至向用户显示虚假对话框。这些事件无法远程启动应用程序(尽管它们可以在本地启动它们)，但是如果它们已经在远程运行，则可以与应用程序进行交互。由于这是一种脚本语言，因此它也可以用于启动更通用的技术，例如通过 python 反弹 shell 。脚本可以通过 <kbd>osascript /path/to/script</kbd> 或从命令行运行 <kbd>osascript -e "script here"</kbd>。

#### 缓解

缓解|描述
:--:|:--
代码签名|要求所有 AppleScript 在执行之前都要由受信任的开发人员 ID 签名，这将阻止随机的 AppleScript 代码执行

#### 检测

通过 osascript 监视 AppleScript 的执行，该脚本可能与系统上发生的其他可疑行为有关。

***

### CMSPT (CMSTP.exe)

>[原文链接](https://attack.mitre.org/techniques/T1191/)  
>[相关链接](https://www.freebuf.com/articles/system/172515.html)

Microsoft 连接管理器配置文件安装程序 (CMSTP.exe) 是用于安装连接管理器服务配置文件的命令行程序。CMSTP.exe 接受安装信息文件 (INF) 作为参数，并安装用于远程访问连接的服务配置文件。

攻击者可能向 **CMSTP.exe** 提供了感染了恶意命令的INF文件。与 **Regsvr32** / **Squiblydoo** 类似，攻击者可能滥用 **CMSTP.exe** 从远程服务器加载和执行 **DLL**  **和/或**  **COM脚本**。由于 **CMSTP.exe** 是合法的、Microsoft 签名的应用程序，因此该执行过程也可以绕过 AppLocker 和其他白名单防御。

**CMSTP.exe** 还可能被滥用于绕过用户帐户控制，并通过自动提升的COM接口执行来自恶意 **INF** 的任意命令。

#### 缓解

缓解|描述
:--:|:--
禁用或删除功能或程序|在给定的环境中，CMSTP.exe 可能不是必需的(除非用于 VPN 连接安装)
预防执行|如果给定系统或网络不需要 CMSTP.exe，可以考虑使用配置为阻止CMSTP.exe 执行的应用程序白名单来防止攻击者潜在的滥用

#### 检测

使用进程监视来检测和分析 CMSTP.exe 的执行和参数。 将 CMSTP.exe 最近调用与之前的已知良好参数和被加载的文件进行比较，以确定异常和潜在的攻击活动。

还可以使用 Sysmon 事件识别 CMSTP.exe 的潜在滥用。 检测策略可能取决于特定的攻击者程序，但可能的规则包括：

- 检测本地/远程 payload 的加载和执行——Event 1(进程创建)，其中 ParentImage 包含 CMSTP.exe  **和/或**  Event 3(网络连接)，其中 Image 包含 CMSTP.exe, DestinationIP 是外部的
- 检测通过自动提升 (auto-elevated) 的 COM 接口绕过用户帐户控制-事件 10 (ProcessAccess)，其中 CallTrace 包含 CMLUA.dll  **和/或**  Event 12 或 13 (RegistryEvent)，其中 TargetObject 包含 CMMGR32.exe。 还可以监视事件，例如进程创建 (Sysmon Event 1)，例如涉及自动提升 CMSTP COM 接口，如 CMSTPLUA (3E5FC7F9-9A51-4367-9063-A120244FBEC7) 和 CMLUAUTIL (3E000D72-A845-4CD9-BD83- 80C07C3B881F)

***

### Command-Line Interface (命令行界面)

>[原文链接](https://attack.mitre.org/techniques/T1059/)

命令行界面提供了一种与计算机系统交互的方式，许多操作系统平台都有该功能。其在 Windows 系统上的一个例子就是 **cmd**，它可以用来执行许多任务，包括执行其他软件。命令行界面可以在本地交互，也可以通过远程桌面应用程序、反弹 shell 等进行远程交互。执行的命令以命令行界面进程的当前权限级别运行，除非该命令包含更改该执行的权限上下文的进程调用(例如，计划任务)。

攻击者可以使用命令行界面与系统交互，并在操作过程中执行其他软件。

#### 缓解

缓解|描述
:--:|:--
预防执行|通过使用应用程序白名单工具来审核 **和/或** 阻止不必要的命令行

#### 检测

可以通过用命令行参数适当记录进程执行来捕获命令行界面活动。这些信息可以帮助他们通过攻击者使用本机进程或自定义工具的方式更多地了解攻击者行为。

***

### Compiled HTML File (.chm文件)

>[原文链接](https://attack.mitre.org/techniques/T1223/)

已编译的HTML文件 (.chm文件) 通常作为 Microsoft HTML 帮助系统的一部分分发。.chm 文件是各种内容(如 HTML 文档、图像)和编程语言相关的脚本/web(如 VBA、JScript、Java 和 ActiveX) 的压缩编译。 CHM 内容使用由 HTML 帮助可执行程序 (hh.exe) 加载的 Internet Explorer 浏览器的底层组件显示。

攻击者可能会滥用该技术来隐藏恶意代码。包含嵌入式有效负载的自定义 .chm文件 可以传递给受害者，然后由 **用户执行** 触发。.chm 执行还可以绕过较旧 **和/或** 未打补丁的系统上的应用白名单，这些系统没有考虑通过 hh.exe 执行二进制文件。

#### 缓解

缓解|描述
:--:|:--
预防执行|如果给定的系统或网络不需要 hh.exe，还可以考虑使用应用程序白名单来阻止 hh.exe 执行，防止潜在的攻击者滥用
限制基于Web的内容|考虑阻止已知在攻击活动中使用的可能不常见的文件类型的下载/传输和执行，比如 .chm 文件

#### 检测

- 监视和分析 hh.exe 的执行和参数。 将 hh.exe 最近的调用与先前已知良好参数的调用进行比较，以确定异常和潜在的攻击活动
- 非标准进程执行树也可能表明可疑或恶意行为，例如 hh.exe 是与其他攻击技术相关的可疑进程和活动的父进程。
- 监视 CHM 文件的存在和使用，特别是如果它们在环境中不按照典型的方式使用

***

### Component Object Model and Distributed COM (COM & DCOM)

>[原文链接](https://attack.mitre.org/techniques/T1175/)

攻击者可以使用 COM 和 DCOM 在本地代码执行，或是作为 **横向移动** 的一部分，让代码远程执行。

COM是本机Windows应用程序编程接口 (API) 的组件，该组件支持软件对象之间的交互，或者实现一个或多个接口的可执行代码。通过COM，客户端对象可以调用服务器对象的方法，这些对象通常是动态链接库 (DLL) 或可执行文件 (EXE) 。 DCOM是透明的中间件，使用远程过程调用 (RPC) 技术将组件对象模型 (COM) 的功能扩展到本地计算机之外。

与本地和远程服务器COM对象进行交互的权限由注册表中的访问控制列表 (ACL) 指定。默认情况下，只有管理员可以通过DCOM远程激活和启动COM对象。

攻击者可能滥用 COM 来执行本地命令 **和/或**  payload。各种 COM 接口被爆出可通过各种编程语言 (例如C，C ++，Java和VBScript) 滥用以调用任意执行。还存在特定的 COM 对象，它们可以直接执行代码执行之外的功能，例如 **创建计划任务** ，**无文件下载/执行** 以及其他攻击性行为，例如 **提权** 和 **持久化**。

攻击者可以使用 DCOM 进行横向移动。 通过 DCOM，在具有适当特权的用户上下文中操作的攻击者可以通过 Office 应用程序 以及其他包含不安全方法的 Windows 对象远程实现任意执行甚至直接执行 shellcode。 DCOM 还可以在现有文档 中执行宏，也可以直接通过 COM 创建的 Microsoft Office 应用程序实例调用动态数据交换 (DDE) ，从而不需要恶意文档。

#### 缓解

缓解|描述
:--:|:--
应用隔离与沙箱机制|确保已启用所有 COM 警报和受保护的视图
禁用或删除功能或程序|考虑通过 Dcomcnfg.exe 禁用 DCOM
网络隔离|启用Windows防火墙，默认情况下会阻止 DCOM 实例化
账户权限|修改注册表设置 (直接或使用Dcomcnfg.exe)<kbd>HKEY_LOCAL_MACHINE\SOFTWARE\Classes\AppID\{{AppID_GUID}}</kbd>以与单个COM应用程序的整个进程的安全性相关联。
账户权限|修改注册表设置 (直接或使用Dcomcnfg.exe)<kbd>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Ole</kbd>与所有未设置自己的进程范围安全性的COM应用程序的系统范围安全性默认值关联

#### 检测

- 监视 COM 对象加载的 DLL 和通常与应用程序无关的其他模块
- 监视与COM对象关联的进程的产生
- 监视分布式计算环境/远程过程调用(DCE / RPC)的异常流量

***

### Control Panel Items (控制面板项)

>[原文链接](https://attack.mitre.org/techniques/T1196/)

Windows控制面板项允许用户查看和调整计算机设置。控制面板项是已注册的可执行文件 (.exe) 或控制面板文件 (.cpl)，实际上后者已经被重命名为动态链接库文件 (.dll)，他可以到处 CPIApplet 函数。控制面板项可以直接从命令行执行，也可以通过应用程序编程接口 (API) 调用以编程方式执行，或者只需双击文件。

为了易用性，控制面板项通常包括用户友好的图形菜单，在控制面板被注册加载后。

攻击者可以使用控制面板项作为 payload 来执行任意命令。恶意控制面板项可以通过以鱼叉式钓鱼附件 (Spearphishing Attachment) 的方式传递或作为多级恶意软件的一部分执行。控制面板项，特别是 CPL 文件，也可以绕过应用程序 **和/或** 文件扩展名白名单。

#### 缓解

缓解|描述
:--:|:--
预防执行|使用应用程序白名单工具，来识别和阻止潜在的恶意和未知.cpl文件
限制文件和目录权限|将控制面板项的存储和执行限制为受保护的目录

#### 检测

- 监视和分析与CPL文件相关的项目相关的活动
- 清单控制面板项，用于查找系统中未注册和潜在的恶意文件
  - 可执行格式注册控制面板项将具有全局唯一标识符(GUID)和在注册的注册表项<kbd>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\ControlPanel\NameSpace</kbd> 和 <kbd>HKEY_CLASSES_ROOT\CLSID{{GUID}}</kbd>这些条目可能包含有关控制面板项的信息，如其显示名称、本地文件的路径以及在控制面板中打开时执行的命令。
  - 存储在System32目录中的CPL格式注册的控制面板项目将自动显示在控制面板中。其他控制面板项目将在<kbd>Cpls</kbd>和<kbd>Extended Properties</kbd>注册表项中具有注册条目<kbd>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Control Panel</kbd>。这些条目可能包括诸如GUID，本地文件的路径以及用于以编程方式( <kbd>WinExec("c:\windows\system32\control.exe {{Canonical_Name}}", SW_NORMAL);</kbd>)或从命令行(<kbd>control.exe /name {{Canonical_Name}}</kbd>)启动文件的规范名称之类的信息
  - 某些控制面板项目可通过注册的Shell扩展名进行扩展，<kbd>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Controls Folder{{name}}\Shellex\PropertySheetHandlers</kbd>,其中{{name}}是系统项目的预定义名称。
- 分析新的控制面板项以及磁盘以查找恶意内容。 可执行文件和 CPL 格式都是兼容的可移植可执行文件 (PE) 映像，直到反逆向之前，都可以使用传统的工具和方法进行检查

***

### Dynamic Data Exchange (动态数据交换协议)

>[原文链接](https://attack.mitre.org/techniques/T1173/)

**DDE** 是一种用于应用程序之间的单次 **和/或** 连续进程间通信 (IPC) 客户端-服务器协议。一旦建立连接，应用程序就可以自主的交换由字符串、[温数据链接](https://blog.csdn.net/Scrat_Kong/article/details/86618907) (数据项更改时的通知)、[热数据链接](https://blog.csdn.net/Scrat_Kong/article/details/86618907) (数据项更改的副本) 以及命令执行请求组成的事务。

对象链接和嵌入 (OLE) 或在文档之间链接数据的功能最初是通过 **DDE** 实现的。尽管已被 **COM** 取代，但可以通过注册表项在Windows 10和大多数Microsoft Office 2016中启用DDE。

攻击者可以使用 DDE 执行任意命令。Microsoft Office 文档可以通过 **DDE** 命令 直接或通过嵌入式文件 被污染，并用于通过钓鱼活动或托管 Web 内容交付执行，避免使用 Visual Basic for Applications (VBA) 宏。在没有命令行执行权限的受感染计算机上，攻击者也可以利用 **DDE**。

#### 缓解

缓解|描述
:--:|:--
应用隔离与沙箱机制|确保已启用**受保护的视图**
终端行为防护|在 Windows 10 上，启用攻击面减少 (ASR) 规则，以防止 DDE 攻击和从 Office 程序生成子进程
禁用或删除功能或程序|可以将 Microsoft Office 功能控制安全性对应的注册表项设置为禁用 DDE/OLE 自动执行。 Microsoft 还创建了注册表项，以完全禁用 Word 和 Excel 中的 DDE 执行
软件配置|确保已启用受保护的视图 并考虑禁用未在受保护的视图中注册的 Office 程序 (如 OneNote)中的嵌入文件

#### 检测

- 可以扫描 OLE 和 Office Open XML 文件中的 **DDEAUTO**、**DDE** 和其他表明 DDE 执行的字符串
- 监视 Microsoft Office 应用程序加载 DLL 和通常与应用程序无关的其他模块
- 监视从 Microsoft Office 应用程序生成的异常进程 (如 cmd.exe)

***

### Execution through API (通过API执行)

>[原文链接](https://attack.mitre.org/techniques/T1106/)

攻击者工具可以直接使用 Windows 应用程序编程接口 (API) 来执行二进制文件。诸如 Windows API CreateProcess 这样的函数将允许程序和脚本使用适当的路径和参数启动其他进程。

例如：

```C++
CreateProcessA() & CreateProcessW()
CreateProcessAsUserA() & CreateProcessAsUserW()
CreateProcessInternalA() & CreateProcessInternalW()
CreateProcessWithLogonW() & CreateProcessWithTokenW()
LoadLibraryA() & LoadLibraryW()
LoadLibraryExA() & LoadLibraryExW()
LoadModule()
LoadPackagedLibrary()
WinExec()
ShellExecuteA() & ShellExecuteW()
ShellExecuteExA() & ShellExecuteExW()
```

#### 缓解

缓解|描述
:--:|:--
预防执行|使用适当的应用程序白名单工具，识别并阻止可能通过此技术执行的潜在恶意软件

#### 检测

监视 API 调用可能会生成大量数据，除非在特定情况下收集，否则可能无法直接用于防御，因为良性使用 Windows API 函数（如 CreateProcess）很常见，难以与恶意行为区分开来。使用 API 监控将其他事件与有关 API 函数调用的行为关联起来，API 监控将其他事件与有关 API 函数调用的行为关联起来，这为确定事件是否是恶意行为造成的提供了额外的上下文。按进程族和进程 ID 对活动进行关联即可。

***

### Execution through Module Load (通过模块加载执行)

>[原文链接](https://attack.mitre.org/techniques/T1129/)

**Windows模块加载程序** 可以通过任意本地路径和任意通用命名规则 (UNC) 网络路径加载DLL。此功能保留在NTDLL.dll中，并且是 **Windows原生API**，可以通过 **Win32** **API** 的 **CreateProcess()** 等调用。

模块加载DLL的方法：

- 通过制定在 **IMPORT** 目录中的 (绝对或相对) 路径名
- 通过EXPORT转发到另一个DLL，该DLL具有 (绝对或相对) 路径名 (但不带扩展名)
- 通过 NTFS 联结或符号链接 program.exe.local 与包含 IMPORT 或转发的 EXPORTs 的目录中指定的 DLL 的 (绝对或相对) 路径名
- 通过 <kbd>\<file name="filename.extension" loadFrom="fully-qualified or relative pathname"\></kbd>嵌入或外部的 **application manifest**。文件名是指 IMPORT 目录中的条目或转发的 EXPORT

#### 缓解

缓解|描述
:--:|:--
预防执行|使用适当的应用程序白名单工具，识别并阻止可能通过此技术执行的潜在恶意软件

#### 检测

合法软件一般只需要加载例程，绑定的 DLL 模块或 Windows 系统 DLL，因此加载非已知的模块可能是可疑的。 将 DLL 模块加载限制在 <kbd>%SystemRoot%</kbd> 和 <kbd>%ProgramFiles%</kbd> 目录，可以防止来自不安全路径的模块加载。 API 监视到的模块加载有关的行为的其他事件和写入磁盘的可疑 DLL ，为事件提供额外的上下文有所联系，这有助于确定是否是由于恶意行为。

***

### Execution for Client Execution (客户端执行的利用)

>[原文链接](https://attack.mitre.org/techniques/T1203/)

## Persistence (持久化)

***

## Privilege Escalation (提权)

***